@{
    ViewData["Title"] = "Seleccionar Fecha y Médico";
}

<h2>Seleccionar Fecha y Médico</h2>

<form id="formCitas">
    <label for="fechaCita">Fecha de la cita:</label>
    <input type="date" id="fechaCita" name="fechaCita">

    <label for="medicoId">Médico:</label>
    <input type="number" id="medicoId" name="medicoId">

    <label for="horaCita">Hora de la cita:</label>
    <select id="horaCita" name="horaCita">
        <!-- Opciones de horas disponibles se añadirán dinámicamente aquí -->
    </select>

    <button type="button" onclick="consultarCita()">Consultar Cita</button>
</form>


<script>
    function consultarCita() {
        var fechaCita = document.getElementById('fechaCita').value;
        var medicoId = document.getElementById('medicoId').value;

        // Realizar la llamada AJAX al controlador CitaController
        $.ajax({
            url: '/Cita/ObtenerHorasDisponibles',
            type: 'POST',
            data: { fechaCita: fechaCita, medicoId: medicoId },
            success: function (response) {
                // Convertir las horas disponibles a formato adecuado
                var horasDisponibles = response.map(hora => new Date('1970-01-01T' + hora).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
                var selectHoras = document.getElementById('horaCita');

                // Limpiar opciones existentes
                selectHoras.innerHTML = '';

                // Agregar las nuevas opciones de horas disponibles
                horasDisponibles.forEach(function (hora) {
                    var option = document.createElement('option');
                    option.text = hora;
                    option.value = hora; // Puedes asignar otro valor si es necesario
                    selectHoras.appendChild(option);
                });
            },
            error: function (error) {
                console.error('Error al obtener las horas disponibles:', error);
            }
        });
    }

    // Llamar a la función inicialmente al cargar la página (opcional)
    $(document).ready(function () {
        consultarCita();
    });

  
</script>

